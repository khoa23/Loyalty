@page
@model LoyaltyWebApp.Pages.Admin.IndexModel
@{
    ViewData["Title"] = "Quản lý quà";
}

<div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Quản lý quà</h2>
        <a href="/Admin/Create" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Thêm quà mới
        </a>
    </div>

    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="alert alert-danger" role="alert">
            @Model.ErrorMessage
        </div>
    }

    <div id="rewardsContainer">
        <div class="text-center mt-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>
</div>

<form id="deleteForm" method="post" style="display: none;">
    <input type="hidden" name="rewardId" id="deleteRewardId" />
</form>

@section Scripts {
    <script>
        function deleteReward(rewardId, rewardName) {
            if (confirm(`Bạn có chắc chắn muốn xóa quà "${rewardName}"?`)) {
                document.getElementById('deleteRewardId').value = rewardId;
                document.getElementById('deleteForm').submit();
            }
        }

        function loadPage(page) {
            fetch('/Reward/GetAdminRewards?page=' + page)
                .then(async response => {
                    if (!response.ok) {
                        const text = await response.text();
                        console.error('Server Error:', text);
                        throw new Error('Lỗi tải dữ liệu (' + response.status + ')');
                    }
                    return response.text();
                })
                .then(html => {
                    document.getElementById('rewardsContainer').innerHTML = html;
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('rewardsContainer').innerHTML = '<div class="alert alert-danger">Không thể tải danh sách quà.<br>' + error.message + '</div>';
                });
        }

        document.addEventListener('DOMContentLoaded', () => loadPage(1));
    </script>
}
