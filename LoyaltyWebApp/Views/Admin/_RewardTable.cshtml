@model LoyaltyWebApp.Models.RewardListViewModel
@{
    var apiBaseUrl = ViewData["ApiBaseUrl"] as string;
    var pageSize = ViewData["PageSize"] as int? ?? 10;
    string GetImageUrl(string url)
    {
        if (string.IsNullOrEmpty(url)) return null;
        if (url.StartsWith("http", StringComparison.OrdinalIgnoreCase)) return url;
        return apiBaseUrl + url.TrimStart('/');
    }
}

@if (Model != null && Model.Data != null && Model.Data.Any())
{
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>STT</th>
                    <th>Tên quà</th>
                    <th>Mô tả</th>
                    <th>Điểm đổi</th>
                    <th>Số lượng</th>
                    <th>Ảnh</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody>
                @{
                    var startIndex = (Model.Page - 1) * pageSize + 1;
                }
                @for (int i = 0; i < Model.Data.Count; i++)
                {
                    var reward = Model.Data[i];
                    var stt = startIndex + i;
                    <tr>
                        <td>@stt</td>
                        <td>@reward.Reward_Name</td>
                        <td>@(reward.Description?.Length > 50 ? reward.Description.Substring(0, 50) + "..." : reward.Description)</td>
                        <td>@reward.Points_Cost</td>
                        <td>@reward.Stock_Quantity</td>
                        <td>
                            @if (!string.IsNullOrEmpty(reward.Image_Url))
                            {
                                <img src="@GetImageUrl(reward.Image_Url)" alt="@reward.Reward_Name" style="max-width: 50px; max-height: 50px;" />
                            }
                            else
                            {
                                <span class="text-muted">Không có ảnh</span>
                            }
                        </td>
                        <td>
                            <a asp-action="Edit" asp-controller="Admin" asp-route-id="@reward.Reward_Id" class="btn btn-sm btn-warning">Sửa</a>
                            <button type="button" class="btn btn-sm btn-danger" onclick="deleteReward('@reward.Reward_Id', '@reward.Reward_Name')">Xóa</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    @if (Model.TotalPages > 1)
    {
        <nav aria-label="Phân trang quà">
            <ul class="pagination justify-content-center">
                @if (Model.HasPrevious)
                {
                    <li class="page-item">
                        <a href="javascript:void(0)" onclick="loadPage(@(Model.Page - 1))" class="page-link">Trước</a>
                    </li>
                }
                else
                {
                    <li class="page-item disabled">
                        <span class="page-link">Trước</span>
                    </li>
                }

                @for (int i = Math.Max(1, Model.Page - 2); i <= Math.Min(Model.TotalPages, Model.Page + 2); i++)
                {
                    if (i == Model.Page)
                    {
                        <li class="page-item active">
                            <span class="page-link">@i</span>
                        </li>
                    }
                    else
                    {
                        <li class="page-item">
                            <a href="javascript:void(0)" onclick="loadPage(@i)" class="page-link">@i</a>
                        </li>
                    }
                }

                @if (Model.HasNext)
                {
                    <li class="page-item">
                        <a href="javascript:void(0)" onclick="loadPage(@(Model.Page + 1))" class="page-link">Sau</a>
                    </li>
                }
                else
                {
                    <li class="page-item disabled">
                        <span class="page-link">Sau</span>
                    </li>
                }
            </ul>
        </nav>

        <div class="text-center text-muted mt-2">
            Trang @Model.Page / @Model.TotalPages
            (Tổng cộng @Model.TotalCount quà)
        </div>
    }
}
else
{
    <div class="alert alert-info">Chưa có quà nào. <a asp-action="Create" asp-controller="Admin">Thêm quà mới</a></div>
}